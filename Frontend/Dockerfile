# Dockerfile para o Frontend KontrollaPro
FROM node:18-alpine as builder

# Definir diretório de trabalho
WORKDIR /app

# Copiar arquivos de dependências
COPY package*.json ./

# Instalar dependências
RUN npm ci

# Copiar código fonte
COPY . .

# Argumentos de build para variáveis de ambiente
ARG VITE_API_URL
ARG VITE_APP_URL
ARG VITE_GOOGLE_CLIENT_ID
ARG VITE_NODE_ENV
ARG VITE_APP_NAME
ARG VITE_APP_VERSION
ARG VITE_ENABLE_ANALYTICS
ARG VITE_ENABLE_ERROR_REPORTING
ARG VITE_ENABLE_PERFORMANCE_MONITORING
ARG VITE_CACHE_ENABLED
ARG VITE_CACHE_TTL
ARG VITE_MAX_FILE_SIZE
ARG VITE_ALLOWED_FILE_TYPES
ARG VITE_SECURE_COOKIES
ARG VITE_SAME_SITE

# Definir variáveis de ambiente
ENV VITE_API_URL=$VITE_API_URL
ENV VITE_APP_URL=$VITE_APP_URL
ENV VITE_GOOGLE_CLIENT_ID=$VITE_GOOGLE_CLIENT_ID
ENV VITE_NODE_ENV=$VITE_NODE_ENV
ENV VITE_APP_NAME=$VITE_APP_NAME
ENV VITE_APP_VERSION=$VITE_APP_VERSION
ENV VITE_ENABLE_ANALYTICS=$VITE_ENABLE_ANALYTICS
ENV VITE_ENABLE_ERROR_REPORTING=$VITE_ENABLE_ERROR_REPORTING
ENV VITE_ENABLE_PERFORMANCE_MONITORING=$VITE_ENABLE_PERFORMANCE_MONITORING
ENV VITE_CACHE_ENABLED=$VITE_CACHE_ENABLED
ENV VITE_CACHE_TTL=$VITE_CACHE_TTL
ENV VITE_MAX_FILE_SIZE=$VITE_MAX_FILE_SIZE
ENV VITE_ALLOWED_FILE_TYPES=$VITE_ALLOWED_FILE_TYPES
ENV VITE_SECURE_COOKIES=$VITE_SECURE_COOKIES
ENV VITE_SAME_SITE=$VITE_SAME_SITE

# Build da aplicação
RUN npm run build

# Estágio de produção com nginx
FROM nginx:alpine

# Copiar arquivos buildados
COPY --from=builder /app/dist /usr/share/nginx/html

# Copiar configuração customizada do nginx
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Expor porta
EXPOSE 80

# Comando para iniciar nginx
CMD ["nginx", "-g", "daemon off;"]
